---
title: Smart Health - ERD (With ClinicalRecordProcedure)
---

erDiagram

    %% ======================================================
    %% ================== PATIENT DOMAIN ====================
    %% ======================================================
    Patient {
        BIGSERIAL patient_id PK
        VARCHAR first_name
        VARCHAR middle_name
        VARCHAR last_name
        VARCHAR maternal_surname
        DATE date_of_birth
        VARCHAR sex
        VARCHAR email
        TIMESTAMP registration_date
        BOOLEAN active
    }

    PatientDocument {
        BIGSERIAL patient_document_id PK
        BIGINT patient_id FK
        INT document_type_id FK
        VARCHAR document_number
        VARCHAR country_issuer
        DATE issue_date
    }

    PatientAddress {
        BIGSERIAL address_id PK
        BIGINT patient_id FK
        VARCHAR address_type
        VARCHAR street_address
        VARCHAR municipality
        VARCHAR department
        CHAR country_code
        VARCHAR postal_code
    }

    PatientPhone {
        BIGSERIAL phone_id PK
        BIGINT patient_id FK
        INT phone_type_id FK
        VARCHAR number
        BOOLEAN is_primary
    }

    EmergencyContact {
        BIGSERIAL contact_id PK
        BIGINT patient_id FK
        VARCHAR name
        VARCHAR relationship
        VARCHAR phone
        VARCHAR email
    }

    %% Relaciones locales (solo alrededor de Patient)
    Patient ||--o{ PatientDocument : "has_document"
    Patient ||--o{ PatientAddress : "has_address"
    Patient ||--o{ PatientPhone : "has_phone"
    Patient ||--o{ EmergencyContact : "has_contact"

    PatientDocument }o--|| DocumentType : "of_type"
    PatientPhone }o--|| PhoneType : "of_type"

    %% ======================================================
    %% ================= PROFESSIONAL DOMAIN ================
    %% ======================================================
    Professional {
        BIGSERIAL professional_id PK
        VARCHAR internal_code
        VARCHAR license_number
        VARCHAR first_name
        VARCHAR middle_name
        VARCHAR last_name
        VARCHAR email_professional
        DATE hire_date
        BOOLEAN active
    }

    ProfessionalSpecialty {
        BIGINT professional_id FK
        INT specialty_id FK
        DATE assigned_date
        BOOLEAN active
    }

    ProfessionalSchedule {
        BIGSERIAL schedule_id PK
        BIGINT professional_id FK
        SMALLINT day_of_week
        TIME start_time
        TIME end_time
        VARCHAR modality
    }

    %% Relaciones locales del profesional
    Professional ||--o{ ProfessionalSpecialty : "has_specialty"
    Professional ||--o{ ProfessionalSchedule : "works_on"
    ProfessionalSpecialty }o--|| Specialty : "of_field"

    %% ======================================================
    %% =================== CLINICAL DOMAIN ==================
    %% ======================================================
    Appointment {
        BIGSERIAL appointment_id PK
        BIGINT patient_id FK
        BIGINT professional_id FK
        DATE date
        TIME start_time
        TIME end_time
        INT appointment_type_id FK
        VARCHAR status
        INT room_id FK
        TEXT reason
        VARCHAR created_by
        TIMESTAMP created_at
    }

    ClinicalRecord {
        BIGSERIAL record_id PK
        BIGINT patient_id FK
        BIGINT professional_id FK
        TIMESTAMP timestamp
        INT record_type_id FK
        TEXT summary_text
        JSONB structured_summary
        BIGINT main_diagnosis_id FK
    }

    ClinicalRecordDiagnosis {
        BIGINT record_id FK
        BIGINT diagnosis_id FK
        BOOLEAN is_primary
    }

    Prescription {
        BIGSERIAL prescription_id PK
        BIGINT record_id FK
        BIGINT professional_id FK
        TIMESTAMP prescription_date
        TEXT notes
    }

    PrescriptionLine {
        BIGSERIAL prescription_line_id PK
        BIGINT prescription_id FK
        BIGINT medication_id FK
        VARCHAR dose
        VARCHAR frequency
        VARCHAR duration
        TEXT instructions
    }

    VitalSign {
        BIGSERIAL vital_sign_id PK
        BIGINT record_id FK
        VARCHAR sign_type
        NUMERIC value
        VARCHAR unit
        TIMESTAMP measured_at
    }

    %% ======================================================
    %% ========= NUEVA TABLA INTERMEDIA =====================
    %% ======================================================
    ClinicalRecordProcedure {
        BIGSERIAL record_procedure_id PK
        BIGINT record_id FK
        BIGINT procedure_id FK
        TIMESTAMP performed_at
        TEXT result
        NUMERIC cost
    }

    %% Relaciones del bloque cl√≠nico
    Patient ||--o{ Appointment : "books"
    Appointment }o--|| Room : "occurs_in"
    Appointment }o--|| AppointmentType : "of_type"
    Appointment ||--|| Professional : "handled_by"

    Patient ||--o{ ClinicalRecord : "has_record"
    ClinicalRecord ||--|| Professional : "authored_by"

    ClinicalRecord ||--o{ ClinicalRecordDiagnosis : "includes"
    ClinicalRecordDiagnosis }o--|| Diagnosis : "references"

    ClinicalRecord ||--o{ ClinicalRecordProcedure : "performs"
    ClinicalRecordProcedure }o--|| Procedure : "describes"

    ClinicalRecord ||--o{ Prescription : "generates"
    Prescription ||--o{ PrescriptionLine : "contains"
    PrescriptionLine }o--|| Medication : "uses"

    ClinicalRecord ||--o{ VitalSign : "records"

    %% ======================================================
    %% =================== INSURANCE DOMAIN =================
    %% ======================================================
    Policy {
        BIGSERIAL policy_id PK
        BIGINT patient_id FK
        BIGINT insurance_company_id FK
        VARCHAR policy_number
        TEXT coverage_summary
        DATE start_date
        DATE end_date
        VARCHAR status
    }

    InsuranceCompany {
        BIGSERIAL insurance_company_id PK
        VARCHAR name
        JSONB contact_info
    }

    %% Relaciones locales del bloque de seguros
    Patient ||--o{ Policy : "insured_by"
    Policy }o--|| InsuranceCompany : "issued_by"

    %% ======================================================
    %% ===================== AUDIT DOMAIN ==================
    %% ======================================================
    AuditLog {
        BIGSERIAL audit_id PK
        VARCHAR user_id 
        VARCHAR role
        VARCHAR entity
        BIGINT entity_id 
        VARCHAR action
        JSONB detail
        TIMESTAMP timestamp
        VARCHAR ip
        VARCHAR application
    }

    %% Relaciones individuales cercanas (no cruzadas)
    AuditLog }o--|| Patient : "logs_patient"
    AuditLog }o--|| Appointment : "logs_appointment"
    AuditLog }o--|| ClinicalRecord : "logs_record"
    AuditLog }o--|| Prescription : "logs_prescription"

    %% ======================================================
    %% ==================== CATALOGS ========================
    %% ======================================================
    Specialty {
        SERIAL specialty_id PK
        VARCHAR name
    }

    Diagnosis {
        BIGSERIAL diagnosis_id PK
        VARCHAR cie_code
        TEXT description
    }

    Medication {
        BIGSERIAL medication_id PK
        VARCHAR atc_code
        VARCHAR trade_name
        VARCHAR active_principle
        VARCHAR presentation
    }

    Procedure {
        BIGSERIAL procedure_id PK
        VARCHAR code
        TEXT description
        NUMERIC reference_price
    }

    AppointmentType {
        SERIAL appointment_type_id PK
        VARCHAR name
    }

    Room {
        SERIAL room_id PK
        VARCHAR name
        VARCHAR location
    }

    DocumentType {
        SERIAL document_type_id PK
        VARCHAR name
    }

    PhoneType {
        SERIAL phone_type_id PK
        VARCHAR name
    }
